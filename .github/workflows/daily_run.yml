name: Daily DevShot

on:
  schedule:
    # í•œêµ­ ì‹œê°„ ì•„ì¹¨ 8ì‹œ = UTC 23ì‹œ (ì „ë‚ )
    - cron: '0 23 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ ì¶”ê°€

jobs:
  run-scraper:
    runs-on: ubuntu-latest
    
    # â˜… ì¤‘ìš”: ë´‡ì´ ì½”ë“œë¥¼ ìˆ˜ì •(Commit)í•  ìˆ˜ ìˆê²Œ ê¶Œí•œ ë¶€ì—¬
    permissions:
      contents: write

    steps:
    - name: ì½”ë“œ ë‚´ë ¤ë°›ê¸° (Checkout)
      uses: actions/checkout@v4

    - name: íŒŒì´ì¬ ì„¤ì • (Set up Python)
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (Install dependencies)
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ë´‡ ì‹¤í–‰ (Run App)
      env:
        # ê¹ƒí—ˆë¸Œ ì„¤ì • í˜ì´ì§€ì—ì„œ ë“±ë¡í•  ë¹„ë°€ í‚¤ë“¤
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        python app.py

    - name: ì¥ë¶€ íŒŒì¼ ì €ì¥ (Commit & Push logs)
      run: |
        git config --global user.name "DevShot Bot"
        git config --global user.email "bot@noreply.github.com"
        
        # sent_logs.json íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì¶”ê°€
        git add sent_logs.json
        
        # ë³€ê²½ì‚¬í•­ì´ ìˆìœ¼ë©´ ì»¤ë°‹í•˜ê³  í‘¸ì‹œ (ì—†ìœ¼ë©´ ì—ëŸ¬ ì•ˆ ë‚´ê³  íŒ¨ìŠ¤)
        git commit -m "ğŸ“ Update sent_logs.json" || exit 0
        git push